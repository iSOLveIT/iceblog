jQuery(document).ready(function ($) {
  "use strict";
  var siteMenuClone = function () {
    $(".js-clone-nav").each(function () {
      var $this = $(this);
      $this
        .clone()
        .attr("class", "site-nav-wrap")
        .appendTo(".site-mobile-menu-body");
    });
    setTimeout(function () {
      var counter = 0;
      $(".site-mobile-menu .has-children").each(function () {
        var $this = $(this);
        $this.prepend('<span class="arrow-collapse collapsed">');
        $this.find(".arrow-collapse").attr({
          "data-toggle": "collapse",
          "data-target": "#collapseItem" + counter,
        });
        $this
          .find("> ul")
          .attr({ class: "collapse", id: "collapseItem" + counter });
        counter++;
      });
    }, 1000);
    $("body").on("click", ".arrow-collapse", function (e) {
      var $this = $(this);
      if ($this.closest("li").find(".collapse").hasClass("show")) {
        $this.removeClass("active");
      } else {
        $this.addClass("active");
      }
      e.preventDefault();
    });
    $(window).resize(function () {
      var $this = $(this),
        w = $this.width();
      if (w > 768) {
        if ($("body").hasClass("offcanvas-menu")) {
          $("body").removeClass("offcanvas-menu");
        }
      }
    });
    $("body").on("click", ".js-menu-toggle", function (e) {
      var $this = $(this);
      e.preventDefault();
      if ($("body").hasClass("offcanvas-menu")) {
        $("body").removeClass("offcanvas-menu");
        $this.removeClass("active");
      } else {
        $("body").addClass("offcanvas-menu");
        $this.addClass("active");
      }
    });
    $(document).mouseup(function (e) {
      var container = $(".site-mobile-menu");
      if (!container.is(e.target) && container.has(e.target).length === 0) {
        if ($("body").hasClass("offcanvas-menu")) {
          $("body").removeClass("offcanvas-menu");
        }
      }
    });
  };
  siteMenuClone();
});
$(function () {
  $(".btn_like").bind("click", function () {
    let blog_slug = $(".btn_like").attr("id");
    let noLikes = $(".btn_like").attr("value");
    let noLikes = parseInt(noLikes);
    if (noLikes === 1) {
      $.post(
        $SCRIPT_ROOT + "/likes",
        { slug: blog_slug, no_likes: noLikes },
        function (data) {
          $("#current_like").text(data.result);
        }
      );
      $("#user_like").removeClass("dislike");
      $("#user_like").addClass("like");
      $(".btn_like").addClass("jump");
      $(".btn_like").val("-1");
    } else {
      $.post(
        $SCRIPT_ROOT + "/likes",
        { slug: blog_slug, no_likes: noLikes },
        function (data) {
          $("#current_like").text(data.result);
        }
      );
      $("#user_like").removeClass("like");
      $("#user_like").addClass("dislike");
      $(".btn_like").removeClass("jump");
      $(".btn_like").val("+1");
    }
  });
});
let approveBtns = document.querySelectorAll("button.btn_approve");
for (let approveBtn of approveBtns) {
  approveBtn.onclick = function () {
    let IDs = approveBtn.getAttribute("id");
    let commentID = $(`[id='${IDs}']`).attr("name");
    let approval = $(`[id='${IDs}']`).attr("value");
    $.post(
      $SCRIPT_ROOT + "/admin_dashboard/comments_approval",
      { IDs: IDs, approval: approval, commentID: commentID },
      function (data) {
        if (data.status === 200) {
          $(`[id='${commentID}']`).fadeOut(1000, "linear");
        }
      }
    );
  };
}
let replyBtns = document.querySelectorAll("button.btn_reply");
for (let replyBtn of replyBtns) {
  var replyBtnIDs = replyBtn.getAttribute("id");
  var replycommentID = $(`[id='${replyBtnIDs}']`).attr("name");
  replyBtn.onclick = function () {
    $(".reply-main").css("display", "block");
    $(".reply-main").fadeIn(1000, "linear");
    $("body").css("overflow-y", "hidden");
  };
}
$(function () {
  $("#reply_send").bind("click", function () {
    $.post(
      $SCRIPT_ROOT + "/admin_dashboard/comments_approval",
      {
        reply_msg: $('input[name="writer_reply"]').val(),
        IDs: replyBtnIDs,
        commentID: replycommentID,
      },
      function (data) {
        if (data) {
          $("#alert_msg").text(data.result);
          $("#reply_alert").css("display", "block");
          $("#reply_alert").fadeOut(2000, "linear");
          $(`[id='${replycommentID}']`).fadeOut(1000, "linear");
        }
      }
    );
    return false;
  });
});

$(function () {
  $(".card > .card-header > button").click(function () {
    $(".reply-main").css("display", "none");
    $(".reply-main").fadeOut(1000, "linear");
    $("body").css("overflow-y", "scroll");
  });
});

var declineBtns = document.querySelectorAll("button.btn_decline");
for (let declineBtn of declineBtns) {
  declineBtn.onclick = function () {
    let IDs = declineBtn.getAttribute("id");
    let commentID = $(`[id='${IDs}']`).attr("name");
    let approval = $(`[id='${IDs}']`).attr("value");
    $.post(
      $SCRIPT_ROOT + "/admin_dashboard/comments_approval",
      { IDs: IDs, approval: approval, commentID: commentID },
      function (data) {
        if (data.status === 200) {
          $(`[id='${commentID}']`).fadeOut(1000, "linear");
        }
      }
    );
  };
}
$(function () {
  $("#showComments").bind("click", function () {
    let btnShowComments = document.getElementById("showComments");
    let classShowComments = btnShowComments.getAttribute("class");
    if (classShowComments === "view") {
      $(".comment-list > .comment").css("display", "block");
      btnShowComments.innerHTML = "Click to Hide Comments &uparrow;";
    } else {
      $(".comment-list > .comment").css("display", "none");
      $(
        ".comment-list > .comment:nth-child(1), .comment-list > .comment:nth-child(2),.comment-list > .comment:nth-child(3), .comment-list > .comment:nth-child(4),.comment-list > .comment:nth-child(5)"
      ).css("display", "block");
      btnShowComments.innerHTML = "Click to View All Comments &downarrow;";
    }
    let changeClassShowComments =
      classShowComments === "view" ? "hide" : "view";
    btnShowComments.setAttribute("class", changeClassShowComments);
  });
});
$(function () {
  $("#btnPostComment").bind("click", function () {
    let category = document
      .getElementById("btnPostComment")
      .getAttribute("blog-category");
    let slug = document.getElementById("btnPostComment").getAttribute("slug");
    let topic = document.getElementById("btnPostComment").getAttribute("name");
    let url = `/${category}/${topic}/${slug}`;
    $.post(
      $SCRIPT_ROOT + url,
      {
        comment_name: document.getElementById("comment_name").value,
        comment_msg: document.getElementById("comment_msg").value,
      },
      function (data) {
        if (data) {
          $("#comment-alert > .alert").text(data.result);
          $("#comment-alert").css("display", "block");
          $("#comment-alert").fadeOut(8000, "linear");
          document.getElementById("comment_name").value = "";
          document.getElementById("comment_msg").value = "";
        }
      }
    );
    return false;
  });
});
$(function () {
  $("#btnSubscribe").bind("click", function () {
    let category = document
      .getElementById("btnSubscribe")
      .getAttribute("blog-category");
    let slug = document.getElementById("btnSubscribe").getAttribute("slug");
    let topic = document.getElementById("btnSubscribe").getAttribute("name");
    let url = `/${category}/${topic}/${slug}`;
    $.post(
      $SCRIPT_ROOT + url,
      { subscriber_email: $('input[id="news_subscribe"]').val() },
      function (data) {
        if (data) {
          $("#newsletter-alert > .alert").text(data.result);
          $("#newsletter-alert").css("display", "block");
          $("#newsletter-alert").fadeOut(3000, "linear");
          document.getElementById("news_subscribe").value = "";
        }
      }
    );
    return false;
  });
});
$(window).scroll(function () {
  if ($(document).scrollTop() > 50) {
    $("header.site-navbar").addClass("change-navbar");
    $("header.site-navbar").addClass("shadow-sm");
  } else {
    $("header.site-navbar").removeClass("shadow-sm");
    $("header.site-navbar").removeClass("change-navbar");
  }
});
